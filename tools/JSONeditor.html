<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JSON Editor</title>
<style>
  body { font-family: Arial, sans-serif; }
  .container { margin: 20px; }
  .input-group, .button-group { margin-bottom: 20px; }
  textarea, select, input, button { width: 100%; }
  textarea { height: 100px; }
  button { padding: 10px; cursor: pointer; }
</style>
</head>
<body>
<div class="container">
  <div class="button-group">
    <button id="addEntry">Add Entry</button>
    <button id="removeEntry">Remove Entry</button>
  </div>
  <div class="input-group">
    <label for="entrySelect">Select Entry:</label>
    <select id="entrySelect"></select>
  </div>
  <div class="input-group">
    <label for="subject">Subject:</label>
    <input type="text" id="subject" placeholder="Enter subject here">
  </div>
  <div class="input-group">
    <label for="body">Body:</label>
    <textarea id="body" placeholder="Enter body here"></textarea>
  </div>
  <div class="input-group">
    <label for="jsonOutput">JSON Output:</label>
    <textarea id="jsonOutput" readonly></textarea>
  </div>
</div>

<script>
  let entries = []; // Array to hold the JSON entries

  function updateDropdown() {
    const select = document.getElementById('entrySelect');
    select.innerHTML = ''; // Clear existing options
    entries.forEach((entry, index) => {
      const option = document.createElement('option');
      option.value = index;
      option.textContent = `Entry ${index + 1}: ${entry.subject}`;
      select.appendChild(option);
    });
  }

  function loadEntry() {
    const index = document.getElementById('entrySelect').value;
    if (entries[index]) {
      const entry = entries[index];
      document.getElementById('subject').value = entry.subject;
      document.getElementById('body').value = entry.body.replace(/\\n/g, "\n");
    }
    updateJsonOutput();
  }

  function updateJsonOutput() {
    document.getElementById('jsonOutput').value = JSON.stringify(entries, null, 2);
  }

  function updateEntry() {
    const index = document.getElementById('entrySelect').value;
    if (entries[index]) {
      entries[index].subject = document.getElementById('subject').value;
      entries[index].body = document.getElementById('body').value.replace(/\n/g, "\\n");
      updateJsonOutput();
    }
  }

  function addEntry() {
    const newEntry = { subject: "New Subject", body: "New Body" };
    entries.push(newEntry);
    updateDropdown();
    document.getElementById('entrySelect').value = entries.length - 1;
    loadEntry();
  }

  function removeEntry() {
    const index = parseInt(document.getElementById('entrySelect').value, 10); // Get the currently selected index
    if (entries.length > 1) { // Ensure there's more than one entry, to keep at least one
        entries.splice(index, 1); // Remove the selected entry
        updateDropdown(); // Update the dropdown to reflect the change

        // Adjust the selected index if the last entry was removed
        if (index >= entries.length) {
            document.getElementById('entrySelect').value = entries.length - 1; // Select the new last entry
        } else {
            document.getElementById('entrySelect').value = index; // Keep the current index selected
        }
        
        loadEntry(); // Load the newly selected entry into the input fields
    } else {
        alert("At least one entry must remain."); // Prevent removal if only one entry exists
    }
}


  function init() {
    // Initialize with one example entry
    entries = [{ subject: "Initial Subject", body: "Initial Body\\nLine 2" }];
    updateDropdown();
    loadEntry();

    document.getElementById('entrySelect').addEventListener('change', loadEntry);
    document.getElementById('subject').addEventListener('input', updateEntry);
    document.getElementById('body').addEventListener('input', updateEntry);
    document.getElementById('addEntry').addEventListener('click', addEntry);
    document.getElementById('removeEntry').addEventListener('click', removeEntry);
  }

  init();
</script>
</body>
</html>
